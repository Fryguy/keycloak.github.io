<!DOCTYPE HTML>
<html lang="en" >
    <!-- Start book Server Installation and Configuration Guide -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Setting Up a Load Balancer | Server Installation and Configuration Guide</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-splitter/splitter.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../../topics/clustering/multicast.html" />
    
    
    <link rel="prev" href="../../topics/clustering/example.html" />
    

        <!-- head:end -->
    </head>
    <body>
        <!-- body:start -->
        
    <div class="book"
        data-level="8.3"
        data-chapter-title="Setting Up a Load Balancer"
        data-filepath="topics/clustering/load-balancer.adoc"
        data-basepath="../.."
        data-revision="Wed Feb 08 2017 07:52:17 GMT+0100 (CET)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="topics/overview.html">
            
                
                    <a href="../../topics/overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Overview
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="topics/overview/recommended-reading.html">
            
                
                    <a href="../../topics/overview/recommended-reading.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Recommended Reading
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="topics/installation.html">
            
                
                    <a href="../../topics/installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Installation
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="topics/installation/system-requirements.html">
            
                
                    <a href="../../topics/installation/system-requirements.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        System Requirements
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="topics/installation/distribution-files-community.html">
            
                
                    <a href="../../topics/installation/distribution-files-community.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Installing Distribution Files
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="topics/installation/directory-structure.html">
            
                
                    <a href="../../topics/installation/directory-structure.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Distribution Directory Structure
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="topics/operating-mode.html">
            
                
                    <a href="../../topics/operating-mode.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Choosing an Operating Mode
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="topics/operating-mode/standalone.html">
            
                
                    <a href="../../topics/operating-mode/standalone.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Standalone Mode
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="topics/operating-mode/standalone-ha.html">
            
                
                    <a href="../../topics/operating-mode/standalone-ha.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Standalone Clustered Mode
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="topics/operating-mode/domain.html">
            
                
                    <a href="../../topics/operating-mode/domain.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Domain Clustered Mode
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="topics/manage.html">
            
                
                    <a href="../../topics/manage.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Managing Config at Runtime
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="topics/database.html">
            
                
                    <a href="../../topics/database.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Relational Database Setup
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="topics/database/checklist.html">
            
                
                    <a href="../../topics/database/checklist.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Setup Checklist
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="topics/database/jdbc.html">
            
                
                    <a href="../../topics/database/jdbc.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        JDBC Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="topics/database/datasource.html">
            
                
                    <a href="../../topics/database/datasource.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        Datasource Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="topics/database/hibernate.html">
            
                
                    <a href="../../topics/database/hibernate.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Hibernate Configuration
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="topics/mongo.html">
            
                
                    <a href="../../topics/mongo.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Mongo DB Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="topics/network.html">
            
                
                    <a href="../../topics/network.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Network Setup
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="topics/network/bind-address.html">
            
                
                    <a href="../../topics/network/bind-address.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Bind Addresses
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="topics/network/ports.html">
            
                
                    <a href="../../topics/network/ports.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Socket Port Bindings
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="topics/network/https.html">
            
                
                    <a href="../../topics/network/https.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        HTTPS/SSL Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="topics/network/outgoing.html">
            
                
                    <a href="../../topics/network/outgoing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        Outgoing HTTP Requests
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="topics/clustering.html">
            
                
                    <a href="../../topics/clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Clustering
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="topics/clustering/recommended.html">
            
                
                    <a href="../../topics/clustering/recommended.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Recommended Network Architecture
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="topics/clustering/example.html">
            
                
                    <a href="../../topics/clustering/example.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Cluster Example
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="8.3" data-path="topics/clustering/load-balancer.html">
            
                
                    <a href="../../topics/clustering/load-balancer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Setting Up a Load Balancer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="topics/clustering/multicast.html">
            
                
                    <a href="../../topics/clustering/multicast.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Multicast Network Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="topics/clustering/serialized.html">
            
                
                    <a href="../../topics/clustering/serialized.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Serialized Cluster Startup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="topics/clustering/booting.html">
            
                
                    <a href="../../topics/clustering/booting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        Booting the Cluster
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="topics/clustering/troubleshooting.html">
            
                
                    <a href="../../topics/clustering/troubleshooting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        Troubleshooting
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="topics/cache.html">
            
                
                    <a href="../../topics/cache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Server Cache Configuration
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="topics/cache/eviction.html">
            
                
                    <a href="../../topics/cache/eviction.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Eviction Policy and Max Entries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="topics/cache/replication.html">
            
                
                    <a href="../../topics/cache/replication.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Replication and Failover
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="topics/cache/disable.html">
            
                
                    <a href="../../topics/cache/disable.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        Disabling Caching
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="topics/cache/clear.html">
            
                
                    <a href="../../topics/cache/clear.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        Clearing Caches at Runtime
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="topics/proxy.html">
            
                
                    <a href="../../topics/proxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Keycloak Security Proxy
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >Server Installation and Configuration Guide</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <div class="sect2">
<h3 id="_setting_up_a_load_balancer_or_proxy">Setting Up a Load Balancer or Proxy</h3>
<div class="paragraph">
<p>This section discusses a number of things you need to configure before you can put a reverse proxy or load balancer
in front of your clustered Keycloak deployment.  It also covers configuring the built in load balancer that
was <a href="../operating-mode/domain.html#_clustered-domain-example">Clustered Domain Example</a>.</p>
</div>
<div class="sect3">
<h4 id="_identifying_client_ip_addresses">Identifying Client IP Addresses</h4>
<div class="paragraph">
<p>A few features in Keycloak rely on the fact that the remote
address of the HTTP client connecting to the authentication server is the real IP address of the client machine.  This can
be problematic when you have a reverse proxy or loadbalancer in front of your Keycloak authentication server.
The usual setup is that you have a frontend proxy sitting on a public network that load balances and forwards requests
to backend Keycloak server instances that sin on a private network.  There is some extra configuration you have to do in this scenario
so that the actual client IP address is forwarded to and processed by the Keycloak server instances.  Specifically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure your reverse proxy (loadbalancer) to properly set <code>X-Forwarded-For</code> and <code>X-Forwarded-Proto</code> HTTP headers.</p>
</li>
<li>
<p>Configure the authentication server to read the client&#x2019;s IP address from <code>X-Forwarded-For header</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuring your proxy to generate the <code>X-Forwarded-For</code> and <code>X-Forwarded-Proto</code> HTTP headers is beyond the scope of this
guide.  Take extra precautions to ensure that the
<code>X-Forwared-For</code> header is set by your proxy.  If your proxy isn&#x2019;t configured correctly, then <em>rogue</em> clients can set this header themselves and trick Keycloak
into thinking the client is connecting from a different IP address than it actually is.  This becomes really important if you are doing
any black or white listing of IP addresses.</p>
</div>
<div class="paragraph">
<p>Beyond the proxy itself, there are a few things you need to configure on the Keycloak side of things.
If your proxy is forwarding requests via the HTTP protocol, then you need to configure Keycloak to pull the client&#x2019;s
IP address from the <code>X-Forwarded-For</code> header rather than from the network packet.
To do this, open up the profile configuration file (<em>standalone.xml</em>, <em>standalone-ha.xml</em>, or <em>domain.xml</em> depending on your
<a href="../operating-mode.html#_operating-mode">operating mode</a>) and look for the <code>&quot;urn:jboss:domain:undertow:3.0</code> XML block.</p>
</div>
<div class="listingblock">
<div class="title"><code>X-Forwarded-For</code> HTTP Config</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">subsystem</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">&quot;urn:jboss:domain:undertow:3.0&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">buffer-cache</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;default&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">server</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;default-server&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">ajp-listener</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;ajp&quot;</span> <span class="hljs-attribute">socket-binding</span>=<span class="hljs-value">&quot;ajp&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">http-listener</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;default&quot;</span> <span class="hljs-attribute">socket-binding</span>=<span class="hljs-value">&quot;http&quot;</span> <span class="hljs-attribute">redirect-socket</span>=<span class="hljs-value">&quot;https&quot;</span>
          <span class="hljs-attribute">proxy-address-forwarding</span>=<span class="hljs-value">&quot;true&quot;</span>/&gt;</span>
      ...
   <span class="hljs-tag">&lt;/<span class="hljs-title">server</span>&gt;</span>
   ...
<span class="hljs-tag">&lt;/<span class="hljs-title">subsystem</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the <code>proxy-address-forwarding</code> attribute to the <code>http-listener</code> element.  Set the value to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>If your proxy is using the AJP protocol instead of HTTP to forward requests (i.e. Apache HTTPD + mod-cluster), then you have
to configure things a little differently.  Instead of modifying the <code>http-listener</code>, you need to add a filter to
pull this information from the AJP packets.</p>
</div>
<div class="listingblock">
<div class="title"><code>X-Forwarded-For</code> AJP Config</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">subsystem</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">&quot;urn:jboss:domain:undertow:3.0&quot;</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">buffer-cache</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;default&quot;</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">server</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;default-server&quot;</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">ajp-listener</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;ajp&quot;</span> <span class="hljs-attribute">socket-binding</span>=<span class="hljs-value">&quot;ajp&quot;</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">http-listener</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;default&quot;</span> <span class="hljs-attribute">socket-binding</span>=<span class="hljs-value">&quot;http&quot;</span> <span class="hljs-attribute">redirect-socket</span>=<span class="hljs-value">&quot;https&quot;</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">host</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;default-host&quot;</span> <span class="hljs-attribute">alias</span>=<span class="hljs-value">&quot;localhost&quot;</span>&gt;</span>
             ...
             <span class="hljs-tag">&lt;<span class="hljs-title">filter-ref</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;proxy-peer&quot;</span>/&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-title">host</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-title">server</span>&gt;</span>
        ...
     <span class="hljs-tag">&lt;<span class="hljs-title">filters</span>&gt;</span>
         ...
         <span class="hljs-tag">&lt;<span class="hljs-title">filter</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;proxy-peer&quot;</span>
                 <span class="hljs-attribute">class-name</span>=<span class="hljs-value">&quot;io.undertow.server.handlers.ProxyPeerAddressHandler&quot;</span>
                 <span class="hljs-attribute">module</span>=<span class="hljs-value">&quot;io.undertow.core&quot;</span> /&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-title">filters</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-title">subsystem</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enable_https_ssl_with_a_reverse_proxy">Enable HTTPS/SSL with a Reverse Proxy</h4>
<div class="paragraph">
<p>Assuming that your reverse proxy doesn&#x2019;t use port 8443 for SSL you also need to configure what port HTTPS traffic is redirected to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">subsystem</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">&quot;urn:jboss:domain:undertow:3.0&quot;</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-title">http-listener</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;default&quot;</span> <span class="hljs-attribute">socket-binding</span>=<span class="hljs-value">&quot;http&quot;</span>
        <span class="hljs-attribute">proxy-address-forwarding</span>=<span class="hljs-value">&quot;true&quot;</span> <span class="hljs-attribute">redirect-socket</span>=<span class="hljs-value">&quot;proxy-https&quot;</span>/&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-title">subsystem</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the <code>redirect-socket</code> attribute to the <code>http-listener</code> element.  The value should be <code>proxy-https</code> which points to a
socket binding you also need to define.</p>
</div>
<div class="paragraph">
<p>Then add a new <code>socket-binding</code> element to the <code>socket-binding-group</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">socket-binding-group</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;standard-sockets&quot;</span> <span class="hljs-attribute">default-interface</span>=<span class="hljs-value">&quot;public&quot;</span>
    <span class="hljs-attribute">port-offset</span>=<span class="hljs-value">&quot;${jboss.socket.binding.port-offset:0}&quot;</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-title">socket-binding</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;proxy-https&quot;</span> <span class="hljs-attribute">port</span>=<span class="hljs-value">&quot;443&quot;</span>/&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-title">socket-binding-group</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_built_in_load_balancer">Using the Built-In Load Balancer</h4>
<div class="paragraph">
<p>This section covers configuring the built in load balancer that is discussed in the
<a href="../operating-mode/domain.html#_clustered-domain-example">Clustered Domain Example</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="../operating-mode/domain.html#_clustered-domain-example">Clustered Domain Example</a> is only designed to run
on one machine.  To bring up a slave on another host, you&#x2019;ll need to</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the <em>domain.xml</em> file to point to your new host slave</p>
</li>
<li>
<p>Copy the server distribution.  You don&#x2019;t need the <em>domain.xml</em>, <em>host.xml</em>, or <em>host-master.xml</em> files.  Nor do you need
the <em>standalone/</em> directory.</p>
</li>
<li>
<p>Edit the <em>host-slave.xml</em> file to change the bind addresses used or override them on the command line</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_register_a_new_host_with_load_balancer">Register a New Host With Load Balancer</h5>
<div class="paragraph">
<p>Let&#x2019;s look first at registering the new host slave with the load balancer configuration in <em>domain.xml</em>.  Open this
file and go to the undertow configuration in the <code>load-balancer</code> profile.  Add a new <code>host</code> definition called
<code>remote-host3</code> within the <code>reverse-proxy</code> XML block.</p>
</div>
<div class="listingblock">
<div class="title">domain.xml reverse-proxy config</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">subsystem</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">&quot;urn:jboss:domain:undertow:3.0&quot;</span>&gt;</span>
  ...
  <span class="hljs-tag">&lt;<span class="hljs-title">handlers</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">reverse-proxy</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;lb-handler&quot;</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">host</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;host1&quot;</span> <span class="hljs-attribute">outbound-socket-binding</span>=<span class="hljs-value">&quot;remote-host1&quot;</span> <span class="hljs-attribute">scheme</span>=<span class="hljs-value">&quot;ajp&quot;</span> <span class="hljs-attribute">path</span>=<span class="hljs-value">&quot;/&quot;</span> <span class="hljs-attribute">instance-id</span>=<span class="hljs-value">&quot;myroute1&quot;</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">host</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;host2&quot;</span> <span class="hljs-attribute">outbound-socket-binding</span>=<span class="hljs-value">&quot;remote-host2&quot;</span> <span class="hljs-attribute">scheme</span>=<span class="hljs-value">&quot;ajp&quot;</span> <span class="hljs-attribute">path</span>=<span class="hljs-value">&quot;/&quot;</span> <span class="hljs-attribute">instance-id</span>=<span class="hljs-value">&quot;myroute2&quot;</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">host</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;remote-host3&quot;</span> <span class="hljs-attribute">outbound-socket-binding</span>=<span class="hljs-value">&quot;remote-host3&quot;</span> <span class="hljs-attribute">scheme</span>=<span class="hljs-value">&quot;ajp&quot;</span> <span class="hljs-attribute">path</span>=<span class="hljs-value">&quot;/&quot;</span> <span class="hljs-attribute">instance-id</span>=<span class="hljs-value">&quot;myroute3&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">reverse-proxy</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">handlers</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-title">subsystem</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>output-socket-binding</code> is a logical name pointing to a <code>socket-binding</code> configured later in the <em>domain.xml</em> file.
the <code>instance-id</code> attribute must also be unique to the new host as this value is used by a cookie to enable sticky
sessions when load balancing.</p>
</div>
<div class="paragraph">
<p>Next go down to the <code>load-balancer-sockets</code> <code>socket-binding-group</code> and add the <code>outbound-socket-binding</code> for <code>remote-host3</code>.  This new
binding needs to point to the host and port of the new host.</p>
</div>
<div class="listingblock">
<div class="title">domain.xml outbound-socket-binding</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">socket-binding-group</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;load-balancer-sockets&quot;</span> <span class="hljs-attribute">default-interface</span>=<span class="hljs-value">&quot;public&quot;</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-title">outbound-socket-binding</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;remote-host1&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">remote-destination</span> <span class="hljs-attribute">host</span>=<span class="hljs-value">&quot;localhost&quot;</span> <span class="hljs-attribute">port</span>=<span class="hljs-value">&quot;8159&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">outbound-socket-binding</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">outbound-socket-binding</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;remote-host2&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">remote-destination</span> <span class="hljs-attribute">host</span>=<span class="hljs-value">&quot;localhost&quot;</span> <span class="hljs-attribute">port</span>=<span class="hljs-value">&quot;8259&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">outbound-socket-binding</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">outbound-socket-binding</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;remote-host3&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">remote-destination</span> <span class="hljs-attribute">host</span>=<span class="hljs-value">&quot;192.168.0.5&quot;</span> <span class="hljs-attribute">port</span>=<span class="hljs-value">&quot;8259&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">outbound-socket-binding</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">socket-binding-group</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_master_bind_addresses">Master Bind Addresses</h5>
<div class="paragraph">
<p>Next thing you&#x2019;ll have to do is to change the <code>public</code> and <code>management</code> bind addresses for the master host.  Either
edit the <em>domain.xml</em> file as discussed in the <a href="../network/bind-address.html#_bind-address">Bind Addresses</a> chapter
or specify these bind addresses on the command line as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ domain.sh --host-config=host-master.xml -Djboss.bind.address=192.168.0.2 -Djboss.bind.address.management=192.168.0.2</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_host_slave_bind_addresses">Host Slave Bind Addresses</h5>
<div class="paragraph">
<p>Next you&#x2019;ll have to change the <code>public</code>, <code>management</code>, and domain controller bind addresses (<code>jboss.domain.master-address</code>).  Either edit the
<em>host-slave.xml</em> file or specify them on the command line as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ domain.sh --host-config=host-slave.xml
     -Djboss.bind.address=192.168.0.5
      -Djboss.bind.address.management=192.168.0.5
       -Djboss.domain.master.address=192.168.0.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The values of <code>jboss.bind.address</code> and <code>jboss.bind.addres.management</code> pertain to the host slave&#x2019;s IP address.
The value of <code>jboss.domain.master.address</code> need to be the IP address of the domain controller which is the management address
of the master host.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_other_load_balancers">Configuring Other Load Balancers</h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/author/display/WFLY10/High+Availability+Guide" target="_blank">the load balancer</a> chapter of the WildFly 10 Documentation
has information on using some other software based load balancers that may help you.</p>
</div>
</div>
</div>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../topics/clustering/example.html" class="navigation navigation-prev " aria-label="Previous page: Cluster Example"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../topics/clustering/multicast.html" class="navigation navigation-next " aria-label="Next page: Multicast Network Setup"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="../../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-ungrey/ungrey.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-splitter/splitter.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"toggle-chapters":{},"ungrey":{},"splitter":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
    </body>
    <!-- End of book Server Installation and Configuration Guide -->
</html>
